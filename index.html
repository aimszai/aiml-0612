<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine'n'Dine'n'Party 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e0e0e0; }
        .neon-text { text-shadow: 0 0 20px rgba(168, 85, 247, 0.6); }
        .glass-card { 
            background: rgba(20, 20, 20, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.08);
        }
        .spotify-card {
            background: linear-gradient(145deg, #101010, #000);
            border: 1px solid #1DB954;
            box-shadow: 0 0 20px rgba(29, 185, 84, 0.1);
        }
        input, select { color: white !important; }
        /* Animationen */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-6px); } 100% { transform: translateY(0px); } }
        .float-anim { animation: float 5s ease-in-out infinite; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        .glow-box { box-shadow: 0 0 25px rgba(168, 85, 247, 0.3); }
        
        /* Like Button Animation */
        .like-btn:active { transform: scale(0.9); }
    </style>
</head>
<body class="bg-[url('https://images.unsplash.com/photo-1516997121675-4c2d1684aa3e?q=80&w=2072&auto=format&fit=crop')] bg-cover bg-fixed bg-center">
    
    <div class="fixed inset-0 bg-gradient-to-b from-black/70 via-black/80 to-black/90 z-0"></div>

    <div id="app" class="relative z-10 min-h-screen flex flex-col items-center p-4 pb-20">

        <header class="text-center mt-12 mb-10 w-full max-w-3xl">
            
            <div class="inline-block px-8 py-3 border-2 border-purple-500 rounded-full text-xl md:text-2xl font-black text-white uppercase tracking-[0.15em] mb-8 bg-purple-900/30 backdrop-blur-xl glow-box animate-pulse">
                06.12.2025
            </div>

            <h1 class="text-5xl md:text-7xl font-black text-white mb-8 tracking-tighter neon-text leading-tight">
                WINE'N'DINE<br>'N'PARTY
            </h1>
            
            <div class="flex flex-wrap items-stretch justify-center gap-3 float-anim">
                
                <a href="https://share.google/VoUdkg1Q3DaoRxw2z" target="_blank" class="flex-1 min-w-[120px] flex flex-col items-center justify-center bg-white/5 hover:bg-white/10 text-white px-4 py-3 rounded-2xl backdrop-blur-md border border-white/10 transition group">
                    <span class="text-xl mb-1">üìç</span>
                    <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">{{ t.location }}</div>
                    <div class="font-bold text-xs group-hover:text-purple-300 transition">Google Maps</div>
                </a>

                <button @click="toggleLang" class="flex items-center justify-center gap-2 bg-black/40 hover:bg-black/60 px-5 rounded-2xl border border-white/10 backdrop-blur-md transition group min-w-[100px]">
                    <span :class="{'text-white font-bold scale-110': currentLang === 'de', 'text-gray-600': currentLang !== 'de'}" class="transition">DE</span>
                    <span class="text-gray-700">|</span>
                    <span :class="{'text-white font-bold scale-110': currentLang === 'en', 'text-gray-600': currentLang !== 'en'}" class="transition">EN</span>
                </button>

                <a href="https://chat.whatsapp.com/J4f98ZakJqEEpmLmwJ3vM3?mode=hqrt1" target="_blank" class="flex-1 min-w-[120px] flex flex-col items-center justify-center bg-[#25D366]/10 hover:bg-[#25D366]/20 text-white px-4 py-3 rounded-2xl backdrop-blur-md border border-[#25D366]/30 transition group">
                    <div class="text-xl mb-1 text-[#25D366]">
                        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                    </div>
                    <div class="text-[10px] text-[#25D366] font-bold uppercase tracking-wider">{{ t.chat }}</div>
                    <div class="font-bold text-xs group-hover:text-[#25D366] transition">WhatsApp</div>
                </a>
            </div>
        </header>

        <div class="w-full max-w-2xl space-y-8">
            
            <section class="glass-card rounded-3xl p-6 md:p-8 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">{{ t.rsvpTitle }}</h2>
                    <span class="text-xs font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded border border-green-500/30 animate-pulse">{{ t.rsvpOpen }}</span>
                </div>
                
                <form @submit.prevent="submitRSVP" class="space-y-5">
                    <input v-model="newGuest.name" required type="text" :placeholder="t.namePlaceholder" class="w-full bg-black/40 border border-gray-600 rounded-xl p-4 focus:border-purple-500 outline-none text-white">
                    <div class="grid grid-cols-2 gap-4">
                        <label class="cursor-pointer border border-gray-600 rounded-xl p-4 hover:bg-white/5 transition" :class="{'border-purple-500 bg-purple-500/20': newGuest.status === 'going'}">
                            <input type="radio" value="going" v-model="newGuest.status" class="hidden"><div class="text-center">üç∑ {{ t.going }}</div>
                        </label>
                        <label class="cursor-pointer border border-gray-600 rounded-xl p-4 hover:bg-white/5 transition" :class="{'border-gray-400 bg-gray-500/20': newGuest.status === 'maybe'}">
                            <input type="radio" value="maybe" v-model="newGuest.status" class="hidden"><div class="text-center">üìÖ {{ t.maybe }}</div>
                        </label>
                    </div>
                    <div class="flex items-center gap-4 bg-black/30 p-3 rounded-xl border border-gray-700">
                        <span class="text-sm font-bold text-gray-400 pl-2">{{ t.plusOneLabel }}</span>
                        <select v-model="newGuest.plusOne" class="flex-1 bg-transparent border-none focus:ring-0 font-bold text-right cursor-pointer">
                            <option :value="0" class="text-black">{{ t.justMe }}</option>
                            <option :value="1" class="text-black">+1 {{ t.person }}</option>
                            <option :value="2" class="text-black">+2 {{ t.people }}</option>
                        </select>
                    </div>
                    <button type="submit" :disabled="loading" class="w-full bg-gradient-to-r from-purple-700 to-indigo-600 text-white font-bold py-4 rounded-xl">
                        {{ loading ? t.sending : t.submitBtn }}
                    </button>
                </form>

                <div class="mt-8 pt-6 border-t border-gray-700/50">
                    <div class="flex justify-between mb-4">
                        <h3 class="text-gray-300 font-medium text-sm">{{ t.guestList }}</h3>
                        <span class="font-bold text-white">{{ totalGuests }}</span>
                    </div>
                    <div class="flex flex-wrap gap-2 max-h-48 overflow-y-auto custom-scroll">
                        <span v-for="guest in guests" :key="guest.id" class="px-3 py-1.5 rounded-lg text-sm border flex items-center gap-2" :class="guest.status === 'going' ? 'bg-purple-500/20 border-purple-500/40 text-purple-200' : 'bg-gray-700/40 border-gray-600 text-gray-400'">
                            {{ guest.name }} <span v-if="guest.plusOne > 0" class="bg-black/40 px-1 rounded text-xs">+{{guest.plusOne}}</span>
                        </span>
                    </div>
                </div>
            </section>

            <section class="spotify-card rounded-3xl p-6 md:p-8 relative overflow-hidden">
                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                    <svg class="w-8 h-8 text-[#1DB954]" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
                    Party Playlist
                </h2>
                
                <div class="mb-5 rounded-xl overflow-hidden shadow-lg bg-black/50">
                    <iframe style="border-radius:12px" 
                        :src="`https://open.spotify.com/embed/playlist/${spotifyPlaylistId}?utm_source=generator&theme=0`" 
                        width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
                    </iframe>
                </div>

                <a :href="`https://open.spotify.com/playlist/${spotifyPlaylistId}`" target="_blank" class="block text-center w-full bg-[#1DB954] hover:bg-[#15883e] text-black font-bold py-3 rounded-xl mb-6 transition">
                    Open in Spotify App üéµ
                </a>

                <div class="border-t border-gray-700 pt-5">
                    <p class="text-green-200/80 text-sm mb-3 font-medium">{{ t.spotifySub }}</p>
                    <form @submit.prevent="submitSong" class="flex gap-3 mb-4">
                        <input v-model="newSong" required type="text" :placeholder="t.songPlaceholder" class="flex-1 bg-black/40 border border-green-500/30 rounded-xl p-3 focus:border-green-400 outline-none text-white text-sm">
                        <button type="submit" class="bg-white/10 hover:bg-white/20 text-green-400 px-4 rounded-xl font-bold">+</button>
                    </form>
                    <div class="space-y-1 max-h-40 overflow-y-auto custom-scroll pr-2">
                        <div v-for="song in songs" :key="song.id" class="text-xs flex justify-between text-gray-400 border-b border-gray-800 py-2">
                            <span>{{ song.text }}</span> <span class="opacity-50 text-[10px]">Wishlist</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="glass-card rounded-3xl p-6 md:p-8 shadow-xl">
                <div class="flex justify-between items-center mb-1">
                    <h2 class="text-xl font-bold text-white">{{ t.ideasTitle }}</h2>
                    <span v-if="currentLang === 'en'" class="text-[10px] bg-blue-500/20 text-blue-300 border border-blue-500/30 px-2 py-0.5 rounded-full flex items-center gap-1">
                        <span class="animate-pulse">‚ú®</span> Auto-Translate Active
                    </span>
                </div>
                <p class="text-sm text-gray-400 mb-4">{{ t.ideasSub }}</p>
                <form @submit.prevent="submitIdea" class="flex gap-2 mb-6">
                    <input v-model="newIdeaText" required type="text" :placeholder="t.ideaPlaceholder" class="flex-1 bg-black/40 border border-gray-600 rounded-xl p-3 focus:border-purple-500 outline-none text-white">
                    <button type="submit" class="bg-gray-700 hover:bg-gray-600 px-5 rounded-xl font-bold text-gray-200">‚ûú</button>
                </form>
                <ul class="space-y-3">
                    <li v-for="idea in ideas" :key="idea.id" class="bg-white/5 p-4 rounded-xl border border-white/5 flex justify-between items-center gap-4 transition hover:bg-white/10">
                        <div class="flex-1 min-w-0">
                            <p class="text-gray-200 text-sm break-words">
                                {{ (currentLang === 'en' && translations[idea.id]) ? translations[idea.id] : idea.text }}
                            </p>
                            <span v-if="currentLang === 'en' && translations[idea.id]" class="text-[10px] text-blue-400/70 border border-blue-400/20 px-1 rounded h-min whitespace-nowrap mt-1 inline-block">Translated</span>
                        </div>
                        
                        <button @click="likeIdea(idea, $event)" class="like-btn flex flex-col items-center justify-center bg-black/40 hover:bg-black/60 w-12 h-12 rounded-xl border border-white/10 transition active:scale-95 group">
                            <span class="text-xl group-hover:scale-110 transition">‚ù§Ô∏è</span>
                            <span class="text-[10px] font-bold text-gray-400">{{ idea.likes || 0 }}</span>
                        </button>
                    </li>
                </ul>
            </section>
        </div>
        
        <footer class="mt-24 text-gray-600 text-xs font-mono">
            HOSTED VIA VERCEL
        </footer>
    </div>

    <script type="module">
        import { createApp, ref, computed, onMounted, watch } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // WICHTIG: updateDoc, doc, increment hinzugef√ºgt
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, doc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyD18cfrkWooD8gOCJ3Y9jo11On8C5aMgm8",
          authDomain: "aiml-0612.firebaseapp.com",
          projectId: "aiml-0612",
          storageBucket: "aiml-0612.firebasestorage.app",
          messagingSenderId: "307354744386",
          appId: "1:307354744386:web:6ab1e4e1ba810a6c0d1fdb",
          measurementId: "G-DSS8YQ3KC4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const spotifyPlaylistId = "1w9Ck7FsQygVra7NCXYiLS"; 

        const messages = {
            de: {
                location: "Ort",
                chat: "Chat",
                rsvpTitle: "Anmeldung",
                rsvpOpen: "RSVP OFFEN",
                namePlaceholder: "Dein Name...",
                going: "Dabei!",
                maybe: "Mal schauen",
                plusOneLabel: "Begleitung:",
                justMe: "Nur ich",
                person: "Person",
                people: "Personen",
                submitBtn: "Absenden ü•Ç",
                sending: "Moment...",
                guestList: "G√§steliste",
                emptyList: "Liste ist noch leer...",
                spotifySub: "Kein Spotify? W√ºnsch dir hier was:",
                songPlaceholder: "Song Titel...",
                emptySongs: "Warteschlange leer",
                ideasTitle: "üí° Sonstige Ideen",
                ideasSub: "Mitbringsel, Spiele, Snacks.",
                ideaPlaceholder: "z.B. Beerpong B√§lle..."
            },
            en: {
                location: "Location",
                chat: "Chat",
                rsvpTitle: "RSVP",
                rsvpOpen: "RSVP OPEN",
                namePlaceholder: "Your name...",
                going: "I'm in!",
                maybe: "Maybe",
                plusOneLabel: "Plus One:",
                justMe: "Just me",
                person: "Person",
                people: "People",
                submitBtn: "Submit ü•Ç",
                sending: "Sending...",
                guestList: "Guest List",
                emptyList: "List is empty...",
                spotifySub: "No Spotify? Request here:",
                songPlaceholder: "Song title...",
                emptySongs: "Queue empty",
                ideasTitle: "üí° Other Ideas",
                ideasSub: "Potluck items, games, snacks.",
                ideaPlaceholder: "e.g. Beerpong balls..."
            }
        };

        createApp({
            setup() {
                const currentLang = ref('de'); 
                const loading = ref(false);
                const guests = ref([]);
                const newGuest = ref({ name: '', status: 'going', plusOne: 0 });
                const ideas = ref([]);
                const translations = ref({}); 
                const songs = ref([]);
                const newIdeaText = ref('');
                const newSong = ref('');

                const toggleLang = () => { currentLang.value = currentLang.value === 'de' ? 'en' : 'de'; };
                const t = computed(() => messages[currentLang.value]);

                const translateText = async (text, targetLang) => {
                    if (!text) return "";
                    try {
                        const langPair = targetLang === 'en' ? 'de|en' : 'en|de';
                        const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`);
                        const data = await res.json();
                        return data.responseData.translatedText;
                    } catch (e) { return text; }
                };

                watch([currentLang, ideas], async () => {
                    if (currentLang.value === 'en') {
                        for (const idea of ideas.value) {
                            if (!translations.value[idea.id]) {
                                await new Promise(r => setTimeout(r, 100)); 
                                const trans = await translateText(idea.text, 'en');
                                translations.value[idea.id] = trans;
                            }
                        }
                    }
                }, { deep: true });

                onMounted(() => {
                    onSnapshot(query(collection(db, "guests"), orderBy("createdAt", "desc")), (snap) => guests.value = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    onSnapshot(query(collection(db, "ideas"), orderBy("createdAt", "desc")), (snap) => ideas.value = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    onSnapshot(query(collection(db, "songs"), orderBy("createdAt", "desc")), (snap) => songs.value = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });

                const totalGuests = computed(() => guests.value.reduce((acc, curr) => acc + 1 + (curr.status === 'going' ? parseInt(curr.plusOne) : 0), 0));
                
                const submitRSVP = async () => {
                    if(!newGuest.value.name) return;
                    loading.value = true;
                    await addDoc(collection(db, "guests"), { ...newGuest.value, createdAt: serverTimestamp() });
                    newGuest.value = { name: '', status: 'going', plusOne: 0 };
                    loading.value = false;
                };

                // Ideen werden jetzt mit likes: 0 initialisiert
                const submitIdea = async () => { 
                    if(newIdeaText.value) { 
                        await addDoc(collection(db, "ideas"), { 
                            text: newIdeaText.value, 
                            likes: 0, 
                            createdAt: serverTimestamp() 
                        }); 
                        newIdeaText.value = ''; 
                    }
                };

                const submitSong = async () => { if(newSong.value) { await addDoc(collection(db, "songs"), { text: newSong.value, createdAt: serverTimestamp() }); newSong.value = ''; }};

                // NEUE LIKE FUNKTION MIT KONFETTI
                const likeIdea = async (idea, event) => {
                    // 1. Confetti z√ºnden (Ursprung ist der geklickte Button)
                    const rect = event.currentTarget.getBoundingClientRect();
                    const x = (rect.left + rect.width / 2) / window.innerWidth;
                    const y = (rect.top + rect.height / 2) / window.innerHeight;

                    confetti({
                        particleCount: 40,
                        spread: 60,
                        origin: { x, y },
                        colors: ['#A855F7', '#EC4899', '#ffffff'], // Lila/Pink Party Theme
                        disableForReducedMotion: true,
                        zIndex: 100
                    });

                    // 2. Datenbank Update
                    try {
                        const ideaRef = doc(db, "ideas", idea.id);
                        await updateDoc(ideaRef, {
                            likes: increment(1)
                        });
                    } catch (e) {
                        console.error("Like failed", e);
                    }
                };

                return { 
                    guests, newGuest, submitRSVP, loading, totalGuests, 
                    ideas, newIdeaText, submitIdea, likeIdea,
                    songs, newSong, submitSong,
                    currentLang, toggleLang, t, translations, spotifyPlaylistId
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
